{% extends "base.html" %}
{% load i18n %}
{% load base_tags %}
{% load static %}
{% load bootstrap_tags %}
{% load client_lib_tags %}

{% block title %} {% trans "Create Dataset"  %} - {{ block.super }}  {% endblock %}

{% block body_class %}layer create{% endblock %}


{% block head %}

{{ block.super }}
{% endblock %}

{% block middle %}

<div class="page-header">
  <h2 class="page-title">{% trans "Create an empty dataset" %}</h2>
</div>

<div class="row">
  <div class="col-md-4">

    {% if error %}
    <div id="errors" class="alert alert-danger">
      <p>{{ error }}</p>
    </div>
    {% endif %}

    <section>
      <form id="layer-create-form"  method="post" action="{% url "dataset_create" %}">
        {% csrf_token %}
        {{ form|as_bootstrap }}

        <div class="input-attrs-wrap">
          <button id="add-attr-button" class="add-attr-button btn btn-primary">{% trans "Add Attribute" %}</button>
        </div>

        <button type="submit" id="layer-create-button" class="btn btn-danger" style="margin-top:20px">{% trans "Create dataset" %}</button>

      </form>
    </section>

  </div>
</div>

<style>
  #wrap {
    padding-left: 5rem;
  }
  .msgapi .page-header {
    border: none;
  }

  .msgapi input.form-control,
  .msgapi select.form-control {
    border: 1px solid #E2E2E2;
    border-radius: 5px;
    height: 3rem;
    font-weight: 400 !important;
    font-size: 18px !important;
  }

  select.form-control {
    background-image: url('/static/img/caret-down-black.svg') !important;
    background-repeat: no-repeat !important;
    background-position: 97% center;
  }

  .input-attrs-wrap {
    text-align: right;
  }

  button {
    border-radius: 5px !important;
    border: none !important;
    color: black !important;
  }

  #add-attr-button {
    background: #E2E2E2;
    font-size: 1.1rem;
    font-weight: 400;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
    padding: .8rem 1.5rem !important;
  }

  #add-attr-button::after {
    content: '';
    background-image: url('/static/img/black-plus-icon.svg');
    width: 24px;
    height: 24px;
    margin-left: .7rem;
  }

  #layer-create-button {
    background: #FFD55E;
    font-size: 1.1rem;
    font-weight: 500;
    padding: 1rem 2rem !important;
  }


</style>
{% endblock %}


{% block extra_script %}

{{ block.super }}

<script type="text/javascript">

    // code inspired by https://www.sanwebe.com/2013/03/addremove-input-fields-dynamically-with-jquery
    var max_attrs = 50;

    var attr_type_select = '<select class="form-control"" \
                                  name="attr-type" style="margin-top:15px"> \
                                <option value="string">{% trans "String" %}</option> \
                                <option value="integer">{% trans "Integer" %}</option> \
                                <option value="float">{% trans "Float" %}</option> \
                                <option value="date">{% trans "Date" %}</option> \
                            </select>'

    var x = 1;
    $(".add-attr-button").click(function(e){
        e.preventDefault();
        if(x < max_attrs){
            $(".input-attrs-wrap").append('<div class="attr-definition"><input type="text" class="form-control" style="margin-top:15px" />' + attr_type_select + '<a href="#" class="remove-attr">Remove</a></div>');
            x++;
        }
    });

    $(".input-attrs-wrap").on("click", ".remove-attr", function(e){
        e.preventDefault();
        $(this).parent('div').remove();
        x--;
    })

    // copy permissions and attributes
    $('#layer-create-form').submit(function(){
      var attrs = {};
      $('.attr-definition').each(function(i, obj) {
          attr_name = obj.childNodes[0].value;
          attr_type = obj.childNodes[1].value;
          attrs[attr_name] = attr_type;
      });
      $('#attributes').val(JSON.stringify(attrs));
    });

</script>

{% endblock extra_script %}